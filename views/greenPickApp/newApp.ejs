<% let appImageExists = app && app.image && app.image.substring(0,4) == 'data';
let action = app ? `/app/${app.id}/edit?_method=PUT` : `/user/add`; %>
<form action="<%= action %>" <% if (!appImageExists) { %>enctype="multipart/form-data" <% } %>method="post">
  <div id="new-app" class="container">

    <% let title = app ? "Edit your GreenPick" : "Add a new GreenPick" %>

    <section>
      <div class="row justify-content-center align-items-center">
        <img src="/images/greenpick/logo3.svg" class="title-logo">
        <h2 class="title-div"><%= title %></h2>
        <img src="/images/greenpick/logo3.svg" class="title-logo">
      </div>
    </section>

    <section>
      <label class="form-group question-field">Name of the application or brand: </label>
      <input class="form-control" type="text" name="name" placeholder="...type here" required=""
      <% if (app) { %> value="<%= app.name %><% } %>">
    </section>

    <section>
      <label class="form-group question-field">Where can users find it?</label>
      <input class="form-control" type="text" name="website" placeholder="...type here" required=""
      <% if (app) { %> value="<%= app.website %><% } %>">
    </section>

    <section>
      <label class="form-group question-field">What category does your app fit in?</label>
      <select class="form-select category-dropdown" name="category">
        <% categories.forEach(category => {
          let selected = app && (app.category.equals(category._id)) ? 'selected="selected"' : ''; %>
          <option value="<%= (category._id) %>" <%= selected %>>
            <% let categoryName = category.name.charAt(0).toUpperCase() + category.name.slice(1); %>
            <%= categoryName %> 
            </option>
        <% }); %>
      </select>
    </section>

    <section id="app-slogan">
      <label class="form-group question-field">Short description / Slogan: </label>
      <input class="form-control" type="text" name="slogan" placeholder="...type here" maxlength="50" rows="2" required=""
      <% if (app) { %> value="<%= app.slogan %><% } %>">
    </section>

    <section id="app-description">
      <label class="form-group question-field">More details about the application: </label>
      <textarea class="form-control" name="description" placeholder="...type here" rows="4"
      required=""><% if (app) { %><%= app.description %><% } %></textarea>
    </section>

    <section id="app-image">
    <% if (appImageExists) { %>
      <h3 class="h4">App logo:</h3>
      <div class="background">
        <img src="<%= app.image %>" class="app-logo" alt="Your app logo for <%= app.name %>">
      </div>
    <% } else { %>
      <label class="question-field" for="upload-image">App logo:</label>
      <input type="file" name="image"id="upload-image" accept="image/*" required="">
    <% } %>
    </section>

    <section id="complete-submit" class="row justify-content-between no-gutters">
      <div class="col pl-0 <% if (app) { %>pl-md-2<% } %> mb-2">
        <% let saveLabel = app ? "Save" : "Complete" %>
        <button id="complete-button" class="btn btn-lg btn-primary w-100" type="submit"><%= saveLabel %></button>
      </div>
      <% if (app) { %>
      <div class="order-md-first col-12 col-md-6 pr-0 pr-md-2">
        <a href="/app/<%= app._id %>/delete?_method=DELETE" id="delete-button" class="btn btn-lg btn-outline-danger w-100"
           onclick="return confirm('Are you sure you want to delete this application?')">
          Delete
        </a>
      </div>
      <% } %>
    </section>
  </div>
</form>

